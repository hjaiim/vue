<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
	<style>
		* {
			padding: 0;
			margin: 0;
		}

		html, body {
			height: 100%;
			cursor: pointer;
			opacity: 0;
		}

		form {
			height: 100%;
			width: 100%;
		}

		.file-wrap {
			width: 100%;
			height: 100%;
			overflow: hidden;
		}

		.file-upload {
			width: 100%;
			height: 100%;
			opacity: 0;
		}
	</style>
</head>
<body>
<form id="form1" method="post" enctype="multipart/form-data"
	  name="form1">
	<div class="none file-wrap">
		<input type="file" name="btn" id="fileBtn" class="file-upload" onchange="onChange_fileBtn()">
		<label id="fileName"></label>
		<input type="text" style="display: none" name="redirectUrl" id="redirectUrl">
		<input type="submit" name="submit" id="submit" style="visibility: hidden;">
		<!--<input type="button" name="cancel" id="cancelBtn" onclick="onClick_cancelBtn()" value="取消"-->
		<!--style="display: none;">-->
	</div>
</form>
</body>
<script>

	var urlData = queryUrl(window.location.href);
	init();
	function init()
	{
		if (urlData.query.type == "pic")
		{
			$("#fileBtn")[0].accept = "image/jpeg,image/x-png";
		}
		else
		{
			$("#fileBtn")[0].accept =
					"application/msword,application/pdf,image/jpeg,image/x-png,	application/vnd.ms-excel,application/vnd.ms-powerpoint,text/plain,aplication/zip,aplication/rar"
		}
		$("#cancelBtn").hide();
	}

	function onChange_fileBtn(e)
	{
		if ($("#fileBtn")[0].files.length > 0)
		{
			var file = $("#fileBtn")[0].files[0];
			var fileName = file.name;
			var fileSize = file.size;
			fileSize = Math.floor(fileSize / 1048576 * 100) / 100 + "MB";
			if (fileSize >= 5)
			{
				var event = new Event("UPLOAD_ERROR");
				window.dispatchEvent(event);
			}
			$("#fileName").html(fileName + "（" + fileSize + "）");
			$("#fileBtn").hide();
			$("#packageBtn").hide();
			$("#cancelBtn").show();
			$("#redirectUrl").val(urlData.query.redirectUrl);
			$("#form1")[0].action = "http://192.168.12.219:8001/file/upload?type" + urlData.query.type
			$("#submit").click();
		}
	}

	function onClick_cancelBtn()
	{
		$("#fileName").html("请选择文件");
		$("#submit").hide();
		$("#cancelBtn").hide();
		$("#fileBtn").show();
		$("#packageBtn").show();
		$("#form1")[0].reset();
	}

	function onClick_packageBtn()
	{
		$.ajax({
			url: "http://{$host}/publish/package",
			type: "get"
		});
		window.location.href = "http://{$host}/upload";
	}

	function getPicType()
	{
		var urlData = queryUrl(window.location.href);
		return urlData.query.picType;
	}
	function queryUrl($query)
	{
		var res = {};
		var url = $query.split("?")[0];
		var port = url.split("://")[0];
		port != "" && (port += "://");
		var tempurl = url.substr(port.length);
		var host = port + tempurl.substring(0, tempurl.indexOf("/"));
		$query = $query.replace(url, "");
		var query = {};
		var bookmark = "";
		$query = $query.trim().replace(/^(\?|#|&)/, '')
		if ($query.indexOf('#') > 0)
		{
			bookmark = $query.substr($query.indexOf('#') + 1);
			$query = $query.replace('#' + bookmark, '');
		}

		if ($query)
		{
			$query.split('&').forEach(function (param)
			{
				var parts = param.replace(/\+/g, ' ').split('=')
				var key = decodeURIComponent(parts.shift())
				var val = parts.length > 0
						? decodeURIComponent(parts.join('='))
						: null

				if (query[key] === undefined)
				{
					query[key] = val
				}
				else if (Array.isArray(query[key]))
				{
					query[key].push(val)
				}
				else
				{
					query[key] = [query[key], val]
				}
			})
		}
		res.url = url;
		res.host = host;
		res.bookmark = bookmark;
		res.query = query;
		return res
	}

</script>
</html>