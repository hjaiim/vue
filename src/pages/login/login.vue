<template>	<div class="wrap-page relative login-page">		<div class="login-wrap is-transformed gray-shadow">			<p class="login-tit">登录创客沃土</p>			<form-input placeholder="请输入登录名" type="text" v-model="account"						:errmsg="errData.account"						@focus="onFocus_formInput('account')"></form-input>			<form-input type="password" placeholder="请输入密码" errmsg="请输入正确的密码" class="sj-psd"						v-model="password" @focus="onFocus_formInput('password')" @keyenter="onClick_loginBtn"						:errmsg="errData.password"></form-input>			<p class="link-forget clear">				<span class="forget-psd right draw-line" @click="onClick_forgetPwdBtn">忘记密码？</span>			</p>			<div class="pointer login-btn ani-time" @click="onClick_loginBtn">登录</div>			<div class="link-keys ">没有账号？<span class="ani-time pointer" @click="onClick_registerBtn">立即注册>></span>			</div>		</div>	</div></template><script type="text/ecmascript-6">	import g from './../../global';	import sha256 from 'sha256';	import FormInput from "../../components/formInput.vue"	var _params = null, _isValid = true;	export default {		created()		{			this.init();		},		data()		{			return {				g: g,				account: '',				password: '',				errData: {}			}		},		components: {			FormInput		},		methods: {			init()			{				this.account = "";				this.password = "";				if (g.core.onMode("testData"))				{					this.account = "auditor11";					this.password = "123456";				}			},			onClick_forgetPwdBtn()			{				g.url = "/resetpwd";			},			onClick_loginBtn()			{				this.checkValid();				if (!_isValid)				{					_isValid = true;					return;				}				_params = {					logon: this.account,					password: sha256(this.password)				};				g.ui.showLoading();				g.net.call('user/login', _params).then((d) =>				{					g.ui.hideLoading();					g.data.save('loginTime', g.timeTool.getNowStamp());					g.data.userInfo.update(d);					g.data.rightPool.update(d.permissionList);					var userData = g.data.userInfo;					var userInfo = {						userId: userData.id,						logon: userData.username,						name: userData.name,						authStatus: userData.authStatus,						msgSwitch: userData.msgSwitch,						stationType: userData.positionType					};					var rightList = [];					for (var id of g.data.rightPool.list)					{						rightList.push({permissionId: id})					};					g.func.updateUserInfo(userInfo);					g.data.save("rightList", JSON.stringify(rightList));					g.event.dispatchEvent('APP_IS_LOGIN');				}, (err) =>				{					g.ui.hideLoading();					this.errData.password = err.errorMsg;					setTimeout(() =>					{						this.errData.password = "";					}, 1500);					this.$forceUpdate();				});			},			onClick_registerBtn()			{				g.url = "/register";			},			onFocus_formInput($type)			{				this.errData[$type] = "";				this.$forceUpdate()			},			checkValid()			{				if (!this.account)				{					this.errData.account = "请输入登录名";					_isValid = false;				}				if (!this.password)				{					this.errData.password = "请输入密码";					_isValid = false;				}				this.$forceUpdate()			}		}	}</script><style lang="sass" rel="stylesheet/scss" type="text/scss">	@import "../../css/base";	@import "../../css/common";	@import "../../css/login";</style>